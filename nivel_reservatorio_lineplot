from dataframes import df_nivel_reservatorio
from bokeh.models import Range1d, HoverTool
from bokeh.plotting import figure, show
import pandas as pd
import numpy as np

def plot_nivel_reservatorio(reservatorios = [1], anos = [2022]):
    #reservatorios = df_nivel_reservatorio["id_reservatorio"].unique()
    df_nivel_reservatorio['data_particao']=pd.to_datetime(df_nivel_reservatorio['data_particao'])

    df_nivel_reservatorio_usado = df_nivel_reservatorio[df_nivel_reservatorio["data_particao"].dt.year.isin(anos)]
    df_nivel_reservatorio_usado = df_nivel_reservatorio_usado[df_nivel_reservatorio_usado["altura_agua"] < 100]

    p = figure(title = "Titulo", x_axis_label = "X", y_axis_label = "Y", 
               x_axis_type = "datetime",
               y_range = Range1d(0, 5),
               width = 800)

    cores = {
        1: "Blue",
        2: "Green",
        3: "Red"
    }

    lines = []
    for reservatorio in reservatorios:
        df_new_line = df_nivel_reservatorio_usado[df_nivel_reservatorio_usado["id_reservatorio"] == reservatorio].sort_values(["data_particao"])

        line = p.line(x = "data_particao", y = "altura_agua", 
                      legend_field = "nome_reservatorio",
                      color=cores[reservatorio],
                      source = df_new_line)
        lines.append(line)

    hovertool = HoverTool(
        tooltips = [("Nível de Água", "@altura_agua"),("Data", "@data_particao{%F}")], 
        formatters = {"@data_particao": "datetime"},
        renderers = lines, 
        mode="vline")
    p.add_tools(hovertool)

    show(p)